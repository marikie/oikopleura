# Apr 4, 2022
python makeAlignmentObjs.py ../last/lastsplitOKI2018_I69_1.0_ERR4570987.out
python getDeletionLengthDistribution.py ./data/readID_alignments_dict_lastsplitOKI2018_I69_10_ERR4570987.pickle > deletionLengthDistribution_lastsplitOKI2018_I69_10_ERR4570987.txt

# Apr 13, 2022
cd data/maturedAdults
python ../../makeAlignmentObjs.py ../../../last/maturedAdults/lastsplitOKI2018_I69_1.0_ERR4570987.maf

cd data/immatureAdults
python ../../makeAlignmentObjs.py ../../../last/immatureAdults/lastsplitOKI2018_I69_1.0_ERR4570986.maf
python ../../getDeletionLengthDistribution.py readID_alignments_dict_lastsplitOKI2018_I69_10_ERR4570986.pickle > deletionLengthDistribution_lastsplitOKI2018_I69_1.0_ERR4570986.txt

cd data/embryos
python ../../makeAlignmentObjs.py ../../../last/embryos/lastsplitOKI2018_I69_1.0_ERR4570985.maf

# Apr 19, 2022
cd data/maturedAdults
python ~/oikopleura/analysis/getSplicingSignalsDistOfExactSplicings.py ~/oikopleura/last/maturedAdults/lastsplitOKI2018_I69_1.0_ERR4570987.maf > splicingSignalsDistOfExactSplicings_matured.tsv 2> splicingSignalsDistOfExactSplicings_matured.error

cd data/immatureAdults
python ~/oikopleura/analysis/getSplicingSignalsDistOfExactSplicings.py ~/oikopleura/last/immatureAdults/lastsplitOKI2018_I69_1.0_ERR4570986.maf > splicingSignalsDistOfExactSplicings_immature.tsv 2> splicingSignalsDistOfExactSplicings_immature.error

cd data/embryos
python ~/oikopleura/analysis/getSplicingSignalsDistOfExactSplicings.py ~/oikopleura/last/embryos/lastsplitOKI2018_I69_1.0_ERR4570985.maf > splicingSignalsDistExactSplicings_embryos.tsv 2> splicingSignalsDistExactSplicings_embryos.error

# May 6, 2022
cd data/embryos
python ../../getDeletionLengthDistribution.py ~/oikopleura/last/embryos/lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted.maf > deletionDist_lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted.txt

cd data/immatureAdults
python ../../getDeletionLengthDistribution.py ~/oikopleura/last/immatureAdults/lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted.maf > deletionLengthDist_lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted.txt

cd data/maturedAdults
python ../../getDeletionLengthDistribution.py ~/oikopleura/last/maturedAdults/lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted.maf > deletionLengthDist_lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted.txt

# May 10, 2022
cd ~/data/oikopleura/analysis/embryos
python ~/oikopleura/analysis/getSplicingSignalsDistOfExactSplicings.py ~/data/oikopleura/last/embryos/lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted.maf > splicingSignalsDistExactSplicings_embryos_filtered_trimmed_sorted.tsv 2> splicingSignalsDistExactSplicings_embryos_filtered_trimmed_sorted.error

cd ~/data/oikopleura/analysis/immatureAdults
python ~/oikopleura/analysis/getSplicingSignalsDistOfExactSplicings.py ~/data/oikopleura/last/immatureAdults/lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted.maf > splicingSignalsDistExactSplicings_immature_filtered_trimmed_sorted.tsv 2> splicingSignalsDistExactSplicings_immature_filtered_trimmed_sorted.error

cd ~/data/oikopleura/analysis/maturedAdults
python ~/oikopleura/analysis/getSplicingSignalsDistOfExactSplicings.py ~/data/oikopleura/last/maturedAdults/lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted.maf > splicingSignalsDistExactSplicings_matured_filtered_trimmed_sorted.tsv 2> splicingSignalsDistExactSplicings_matured_filtered_trimmed_sorted.error

# May 31, 2022
# ---- tandem repeats -----
cd ~/data/oikopleura/tandemRepeats
tantan -f 4 ~/data/oikopleura/OKI2018_I69_1.0_alignments_with_different_parameters/copy_of_the_genomes/OKI2018_I69_1.0.removed_chrUn.fa > tandemrepeats_OKI2018_I69_1.0.removed_chrUn.tsv

# June 1, 2022
# ---- search tantan-splits ----
python getTanTanSplits.py ~/data/oikopleura/tandemRepeats/tandemrepeats_OKI2018_I69_1.0.removed_chrUn.tsv ~/data/oikopleura/last/embryos/lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted.maf > ~/data/oikopleura/tandemRepeats/embryos_tantansplits.out
python getTanTanSplits.py ~/data/oikopleura/tandemRepeats/tandemrepeats_OKI2018_I69_1.0.removed_chrUn.tsv ~/data/oikopleura/last/immatureAdults/lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted.maf > ~/data/oikopleura/tandemRepeats/immatureAdults_tantansplits.out
python getTanTanSplits.py ~/data/oikopleura/tandemRepeats/tandemrepeats_OKI2018_I69_1.0.removed_chrUn.tsv ~/data/oikopleura/last/maturedAdults/lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted.maf > ~/data/oikopleura/tandemRepeats/maturedAdults_tantansplits.out

# -----------------------------------
# check rna-seq data type
# using RSeQC's infer_experiment.py
# -----------------------------------
# Download .fna and .gff files
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/000/209/535/GCA_000209535.1_ASM20953v1/GCA_000209535.1_ASM20953v1_genomic.fna.gz
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/000/209/535/GCA_000209535.1_ASM20953v1/GCA_000209535.1_ASM20953v1_genomic.gff.gz
# Convert .gff to .bed using AGAT
agat_convert_sp_gff2bed.pl --gff GCA_000209535.1_ASM20953v1_genomic.gff -o GCA_000209535.1_ASM20953v1_genomic_agat.bed
# Convert .gff to .gtf using AGAT
agat_convert_sp_gff2gtf.pl --gff GCA_000209535.1_ASM20953v1_genomic.gff -o GCA_000209535.1_ASM20953v1_genomic_agat.gtf
# STAR: generate genome indexes
STAR --runThreadN 3 --runMode genomeGenerate --genomeDir genome_index_ASM20953v1 --genomeFastaFiles ../ASM20953v1/GCA_000209535.1_ASM20953v1_genomic.fna --sjdbGTFfile ../ASM20953v1/GCA_000209535.1_ASM20953v1_genomic_agat.gtf --sjdbOverhang 99
# STAR: alignment
STAR --runThreadN 3 --genomeDir genome_index_ASM20953v1 --outFileNamePrefix embryos --readFilesIn ../rna-seq-data/embryos/ERR4570985_1_filtered_trimmed_sorted.fastq ../rna-seq-data/embryos/ERR4570985_2_filtered_trimmed_sorted.fastq
STAR --runThreadN 3 --genomeDir genome_index_ASM20953v1 --outFileNamePrefix immatureAdults --readFilesIn ../rna-seq-data/immatureAdults/ERR4570986_1_filtered_trimmed_sorted.fastq ../rna-seq-data/immatureAdults/ERR4570986_2_filtered_trimmed_sorted.fastq
STAR --runThreadN 3 --genomeDir genome_index_ASM20953v1 --outFileNamePrefix maturedAdults --readFilesIn ../rna-seq-data/maturedAdults/ERR4570987_1_filtered_trimmed_sorted.fastq ../rna-seq-data/maturedAdults/ERR4570987_2_filtered_trimmed_sorted.fastq
# Convert .sam to .bam
samtools view -b embryosAligned.out.sam > embryosAligned.out.bam
samtools view -b immatureAdultsAligned.out.sam > immatureAdultsAligned.out.bam
samtools view -b maturedAdultsAligned.out.sam > maturedAdultsAligned.out.bam
# infer_experiment.py
infer_experiment.py -r ../ASM20953v1/GCA_000209535.1_ASM20953v1_genomic_agat.bed -i embryosAligned.out.bam
infer_experiment.py -r ../ASM20953v1/GCA_000209535.1_ASM20953v1_genomic_agat.bed -i immatureAdultsAligned.out.bam
infer_experiment.py -r ../ASM20953v1/GCA_000209535.1_ASM20953v1_genomic_agat.bed -i maturedAdultsAligned.out.bam

# June 9, 2022
# Post-masking
last-postmask lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted.maf > lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted_postmask.maf
last-postmask lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted.maf > lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted_postmask.maf
last-postmask lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted.maf > lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted_postmask.maf

# June 10, 2022
# search tan-tan splits
python getTanTanSplits.py ~/data/oikopleura/tandemRepeats/tandemrepeats_OKI2018_I69_1.0.removed_chrUn.tsv ~/data/oikopleura/last/embryos/lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted_postmask.maf > ~/data/oikopleura/tandemRepeats/embryos_postmask_tantansplits.out 2> ~/data/oikopleura/tandemRepeats/embryos_postmask_tandemexpansion_and_error.err 

# June 22, 2022
# search tan-tan splits
python getTanTanSplits.py ~/data/tandemRepeats/tandemrepeats_OKI2018_I69_1.0.removed_chrUn.tsv ~/data/last/embryos/lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted_postmask.maf ~/data/tandemRepeats/embryos_postmask.out 2> ~/data/tandemRepeats/embryos_tandemexpansion_postmask.out 
python getTanTanSplits.py ~/data/tandemRepeats/tandemrepeats_OKI2018_I69_1.0.removed_chrUn.tsv ~/data/last/immatureAdults/lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted_postmask.maf ~/data/tandemRepeats/immatureAdults_tantansplits.out 2> ~/data/tandemRepeats/immatureAdults_tandemexpansion.out
python getTanTanSplits.py ~/data/tandemRepeats/tandemrepeats_OKI2018_I69_1.0.removed_chrUn.tsv ~/data/last/maturedAdults/lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted_postmask.maf ~/data/tandemRepeats/matureAdults_postmask.out 2> ~/data/tandemRepeats/matureAdults_tandemexpansion.out

# make intron files
python makeIntronJsonFile.py ~/data/last/embryos/lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted_postmask.maf ~/data/analysis/embryos/canonical_introns_embryos.json ~/data/analysis/embryos/non-canonical_introns_embryos.json
python makeIntronJsonFile.py ~/data/last/immatureAdults/lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted_postmask.maf ~/data/analysis/immatureAdults/canonical_introns_immatureAdults.json ~/data/analysis/immatureAdults/non-canonical_introns_immatureAdults.json
python makeIntronJsonFile.py ~/data/last/maturedAdults/lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted_postmask.maf ~/data/analysis/maturedAdults/canonical_introns_matureAdults.json ~/data/analysis/maturedAdults/non-canonical_introns_matureAdults.json

# June 23, 2022
python getOverlappingIntrons.py ~/data/analysis/embryos/canonical_introns_embryos.json ~/data/analysis/embryos/overlapping_introns_canonical_embryos.json
python getOverlappingIntrons.py ~/data/analysis/immatureAdults/canonical_introns_immatureAdults.json ~/data/analysis/immatureAdults/overlapping_introns_canonical_immatureAdults.json
python getOverlappingIntrons.py ~/data/analysis/maturedAdults/canonical_introns_matureAdults.json ~/data/analysis/maturedAdults/overlapping_introns_canonical_maturedAdults.json

# June 24, 2022
python extractNoSharingIntrons.py ~/data/analysis/embryos/overlapping_introns_canonical_embryos.json ~/data/analysis/embryos/overlapping_introns_canonical_unique_embryos.json
