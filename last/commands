# 16 March, 2022
# maturedAdults
lastdb OKI2018_I69_1.0db ~/data/oikopleura/OKI2018_I69_1.0_alignments_with_different_parameters/copy_of_the_genomes/OKI2018_I69_1.0.removed_chrUn.fa

last-train -Q0 OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/maturedOikopleuraAdults/ERR4570987.fastq > trainOKI2018_I69_1.0_ERR4570987.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570987.out OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/maturedOikopleuraAdults/ERR4570987.fastq | last-split -d2 -g OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570987.out

# 11 April, 2022
# immatureAdults
last-train -Q0 ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/immatureAdults/ERR4570986.fastq > trainOKI2018_I69_1.0_ERR4570986.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570986.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/immatureAdults/ERR4570986.fastq | last-split -d2 -g ../OKI2018_I69_1.0db/OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570986.out

# embryos
last-train -Q0 ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/embryos/ERR4570985.fastq > trainOKI2018_I69_1.0_ERR4570985.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570985.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/embryos/ERR4570985.fastq | last-split -d2 -g ../OKI2018_I69_1.0db/OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570985.out

# 3 May, 2022
# maturedAdults
last-train -Q0 ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/maturedAdults/ERR4570987_1_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_ERR4570987_sorted.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570987_sorted.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/maturedAdults/ERR4570987_filtered_trimmed_sorted.fastq | last-split -d2 -M3.78 -S0.065 -g ../OKI2018_I69_1.0db/OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted.maf

# immatureAdults
last-train -Q0 ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/immatureAdults/ERR4570986_1_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_ERR4570986_sorted.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570986_sorted.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/immatureAdults/ERR4570986_filtered_trimmed_sorted.fastq | last-split -d2 -M3.78 -S0.065 -g ../OKI2018_I69_1.0db/OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted.maf

# embryos
last-train -Q0 ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/embryos/ERR4570985_1_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_ERR4570985_sorted.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570985_sorted.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ~/data/oikopleura/rna-seq-data/embryos/ERR4570985_filtered_trimmed_sorted.fastq | last-split -d2 -M3.78 -S0.065 -g ../OKI2018_I69_1.0db/OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted.maf

# May 11, 2022
# embryos
last-train -Q0 ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ../../rna-seq-data/embryos/ERR4570985_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_ERR4570985_sorted.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570985_sorted.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ../../rna-seq-data/embryos/ERR4570985_filtered_trimmed_sorted.fastq | last-split -d2 -M3.78 -S0.065 -g ../OKI2018_I69_1.0db/OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570985_filtered_trimmed_sorted.maf

# immature adults
last-train -Q0 ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ../../rna-seq-data/immatureAdults/ERR4570986_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_ERR4570986_sorted.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570986_sorted.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ../../rna-seq-data/immatureAdults/ERR4570986_filtered_trimmed_sorted.fastq | last-split -d2 -M3.78 -S0.065 -g ../OKI2018_I69_1.0db/OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570986_filtered_trimmed_sorted.maf

# matured adults
last-train -Q0 ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ../../rna-seq-data/maturedAdults/ERR4570987_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_ERR4570987_sorted.out

lastal -D10 -p trainOKI2018_I69_1.0_ERR4570987_sorted.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ../../rna-seq-data/maturedAdults/ERR4570987_filtered_trimmed_sorted.fastq | last-split -d2 -M3.78 -S0.065 -g ../OKI2018_I69_1.0db/OKI2018_I69_1.0db > lastsplitOKI2018_I69_1.0_ERR4570987_filtered_trimmed_sorted.maf

# May 30, 2022
# To know strandedness of the RNA-seq data
# embryos
lastal -p trainOKI2018_I69_1.0_ERR4570985_sorted.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ../../rna-seq-data/embryos/ERR4570985_1_filtered_trimmed_sorted.fastq > lastal_ERR4570985_1_filtered_trimmed_sorted.maf

lastal -p trainOKI2018_I69_1.0_ERR4570985_sorted.out ../OKI2018_I69_1.0db/OKI2018_I69_1.0db ../../rna-seq-data/embryos/ERR4570985_filtered_trimmed_sorted.fastq > lastal_ERR4570985_filtered_trimmed_sorted.maf

# July 15, 2022
# lastdb 
lastdb OKI2018_I69_1.0_whole.DB OKI2018_I69_1.0.fa
# last-train
#  - embryos
last-train -Q0 ../OKI2018_I69_1.0_whole.DB/OKI2018_I69_1.0_whole.DB ../../rna-seq-data/embryos/ERR4570985_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_whole_ERR4570985.out
#  - immatureAdults
last-train -Q0 ../OKI2018_I69_1.0_whole.DB/OKI2018_I69_1.0_whole.DB ../../rna-seq-data/immatureAdults/ERR4570986_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_whole_ERR4570986.out
#  - maturedAdults
last-train -Q0 ../OKI2018_I69_1.0_whole.DB/OKI2018_I69_1.0_whole.DB ../../rna-seq-data/maturedAdults/ERR4570987_filtered_trimmed_sorted.fastq > trainOKI2018_I69_1.0_whole_ERR4570987.out
# lastal
#  - embryos
lastal -D10  --split-d 2 --split-M 3.78 --split-S 0.065 -p trainOKI2018_I69_1.0_whole_ERR4570985.out ../OKI2018_I69_1.0_whole.DB/OKI2018_I69_1.0_whole.DB ../../rna-seq-data/embryos/ERR4570985_*_filtered_trimmed_sorted.fastq > lastsplitOKI2018_I69_1.0_whole_ERR4570985_filtered_trimmed_sorted.maf

# July 19, 2022
# fastq-interleave -> lastal -> last-postmask
#  - embryos
fastq-interleave ../../rna-seq-data/embryos/ERR4570985_1_filtered_trimmed_sorted.fastq ../../rna-seq-data/immatureAdults/ERR4570986_2_filtered_trimmed_sorted.fastq | lastal -D10 --split-d 2 --split-M 3.78 --split-S 0.065 -p trainOKI2018_I69_1.0_whole_ERR4570985.out ../OKI2018_I69_1.0_whole.DB/OKI2018_I69_1.0_whole.DB | last-postmask > ~/.data/lastsplitOKI2018_I69_1.0_whole_ERR4570985_filtered_trimmed_sorted_interleaved_postmask.maf
fastq-interleave ERR4570985_1_filtered_trimmed_sorted.fastq ERR4570985_2_filtered_trimmed_sorted.fastq > ERR4570985_filtered_trimmed_sorted_interleaved.fastq
#  - immatureAdults
fastq-interleave ERR4570986_1_filtered_trimmed_sorted.fastq ERR4570986_2_filtered_trimmed_sorted.fastq > ERR4570986_filtered_trimmed_sorted_interleaved.fastq
lastal -D10 --split-d 2 --split-M 3.78 --split-S 0.065 -p trainOKI2018_I69_1.0_whole_ERR4570986.out ../OKI2018_I69_1.0_whole.DB/OKI2018_I69_1.0_whole.DB ../../rna-seq-data/immatureAdults/ERR4570986_filtered_trimmed_sorted_interleaved.fastq | last-postmask > lastsplitOKI2018_I69_1.0_whole_ERR4570986_filtered_trimmed_sorted_interleaved_postmask.maf
#  - maturedAdults
fastq-interleave ERR4570987_1_filtered_trimmed_sorted.fastq ERR4570987_2_filtered_trimmed_sorted.fastq > ERR4570987_filtered_trimmed_sorted_interleaved.fastq
lastal -D10 --split-d 2 --split-M 3.78 --split-S 0.065 -p trainOKI2018_I69_1.0_whole_ERR4570987.out ../OKI2018_I69_1.0_whole.DB/OKI2018_I69_1.0_whole.DB ../../rna-seq-data/maturedAdults/ERR4570987_filtered_trimmed_sorted_interleaved.fastq | last-postmask > lastsplitOKI2018_I69_1.0_whole_ERR4570987_filtered_trimmed_sorted_interleaved_postmask.maf

# July 22, 2022
# re-make lastsplit alignment file of embryos
# because the previous command was wrong
# (reads of embryos and immatureAdults are mistakenly merged)
lastal -D10 --split-d 2 --split-M 3.78 --split-S 0.065 -p trainOKI2018_I69_1.0_whole_ERR4570985.out ../OKI2018_I69_1.0_whole.DB/OKI2018_I69_1.0_whole.DB ../../rna-seq-data/embryos/ERR4570985_filtered_trimmed_sorted_interleaved.fastq |last-postmask > lastsplitOKI2018_I69_1.0_whole_ERR4570985_filtered_trimmed_sorted_interleaved_postmask.maf

# August 17, 2022
# make Transposable Element database

# lastdb
# -R: specify lowercase usage with two digits
#     first digit:  0: Convert the input sequences to uppercase while reading them.
#     second digit: 1: Convert simple repeats (e.g. cacacacacacacacac) to
#                      lowercase.  This uses tantan, which reliably prevents
#                      non-homologous alignments, unlike other repeat finders.
lastdb -R01 Oikopleura.dioica_TEdb ../Data_S1_bank_dioica_tot.fa

# last-train
# --revsym: Force the substitution scores to have reverse-complement
#           symmetry, e.g. score(A→G) = score(T→C).  This is often
#           appropriate, if neither strand is "special".
# -X1: How to score a match/mismatch involving N (for DNA) or X
#      (otherwise). 1 means treat reference Ns/Xs as fully-ambiguous letters.
# -m100: Maximum number of initial matches per query position.
# -P: Number of parallel threads.
last-train -P8 --revsym -X1 -m100 Oikopleura.dioica_TEdb ../OKI2018_I69_1.0.fa > last-train_Okipleura.dioica_TE.mat

# lastal
# -i3G: Process the query sequences in batches, of at most this many
#       bytes.  If a single sequence exceeds this amount, however, it is
#       not split.  You can use suffixes K, M, and G to specify KibiBytes,
#       MebiBytes, and GibiBytes.  This option makes -P less
#       efficient, because each batch is separately multi-threaded, but it
#       fixes the output order to be the same as the input.
# -m100: Maximum multiplicity for initial matches.  Each initial match is
#        lengthened until it occurs at most this many times in the reference. 
# -D1e7: Report alignments that are expected by chance at most once per LENGTH query letters. 

# Sep 6, 2022
# To use IGV
# embryos
# MAF -> SAM

# samtools SAM -> BAM

